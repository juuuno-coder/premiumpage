"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
var CommonTab = /*#__PURE__*/function () {
  function CommonTab(name, dir, focusPanel) {
    _classCallCheck(this, CommonTab);
    this.name = name;
    this.focusIndex = 0;
    this.wrapper = document.querySelector(this.name);
    this.tabs = this.wrapper.querySelectorAll('[role="tab"]');
    this.tabList = this.wrapper.querySelector('[role="tablist"]');
    this.tabPanels = this.wrapper.querySelectorAll('[role="tabpanel"]');
    this.dir = dir;
    this.focusPanel = typeof focusPanel !== 'undefined' ? focusPanel : true;
  }
  _createClass(CommonTab, [{
    key: "init",
    value: function init(initialIndex) {
      var _this = this;
      if (initialIndex) {
        if (initialIndex > this.tabs.length) {
          this.focusIndex = 0;
        } else {
          this.focusIndex = initialIndex;
        }
      }
      //tab aria setting & add event handler
      this.tabs.forEach(function (tab, idx) {
        tab.setAttribute("aria-selected", idx == _this.focusIndex);
        tab.setAttribute("tabindex", idx == _this.focusIndex ? 0 : -1);

        //22.11.22 접근성 a tag title설정
        if (idx == _this.focusIndex) {
          var name = tab.dataset.name;
          tab.setAttribute('title', "".concat(name, " \uC120\uD0DD\uB428"));
        }
        tab.addEventListener("click", function () {
          return _this.show(tab.getAttribute("aria-controls"));
        });
      });

      //tabpanel aria setting

      this.tabPanels.forEach(function (tabPanel, idx) {
        _this.focusPanel && tabPanel.setAttribute("tabindex", idx == _this.focusIndex ? 0 : -1);
        idx != _this.focusIndex && tabPanel.setAttribute("hidden", true);
      });

      //keyboard arrow action
      this.tabList.addEventListener("keydown", function (e) {
        return _this.keydown(e);
      });

      //tab focusout fix
      this.tabList.addEventListener("focusout", function (e) {
        if (e.relatedTarget && e.relatedTarget.getAttribute('role') == "tab") return;
        var tempTab = [];
        this.wrapper.querySelectorAll('[role="tab"]').forEach(function (tab) {
          tempTab.push(tab.getAttribute('aria-selected'));
        });
        this.focusIndex = tempTab.indexOf('true', 0);
        this.tabs.forEach(function (tab) {
          tab.setAttribute("tabindex", -1);
        });
        this.tabs[this.focusIndex].setAttribute("tabindex", 0);
      }.bind(this));
    }
  }, {
    key: "keydown",
    value: function keydown(e) {
      var prevKeyNum = 37;
      var nextKeyNum = 39;
      if (this.dir === 'vertical') {
        prevKeyNum = 38;
        nextKeyNum = 40;
      }
      if (e.keyCode === nextKeyNum || e.keyCode === prevKeyNum) {
        //세로 스크롤막기
        this.dir === 'vertical' && e.preventDefault();
        this.tabs[this.focusIndex].setAttribute("tabindex", -1);
        if (e.keyCode === nextKeyNum) {
          this.focusIndex++;
          if (this.focusIndex >= this.tabs.length) {
            this.focusIndex = 0;
          }
        } else if (e.keyCode === prevKeyNum) {
          this.focusIndex--;
          if (this.focusIndex < 0) {
            this.focusIndex = this.tabs.length - 1;
          }
        }
        this.tabs[this.focusIndex].setAttribute("tabindex", 0);
        this.tabs[this.focusIndex].focus();
      }
    }
  }, {
    key: "show",
    value: function show(id) {
      var _this2 = this;
      this.tabs.forEach(function (tab) {
        var name = tab.getAttribute("aria-controls");
        if (name == id) {
          tab.setAttribute("aria-selected", true);
          tab.setAttribute("tabindex", 0);

          //22.11.22 접근성 a tag title설정
          var _name = tab.dataset.name;
          tab.setAttribute('title', "".concat(_name, " \uC120\uD0DD\uB428"));
        } else {
          tab.setAttribute("aria-selected", false);
          tab.setAttribute("tabindex", -1);

          //22.11.22 접근성 a tag title설정
          tab.removeAttribute('title');
        }
      });
      this.tabPanels.forEach(function (tabPanel) {
        var name = tabPanel.getAttribute("id");
        if (name == id) {
          tabPanel.removeAttribute("hidden");
          _this2.focusPanel && tabPanel.setAttribute("tabindex", 0);
        } else {
          tabPanel.setAttribute("hidden", true);
          _this2.focusPanel && tabPanel.setAttribute("tabindex", -1);
        }
      });

      //22.3.16 추가 : 해당탭패널 내부에 슬릭 슬라이드가 있으면 setPosition
    //   $(this.tabPanels).find('.slick-slider').each(function () {
    //     $(this).slick('setPosition');
    //   });
    }
  }]);
  return CommonTab;
}();
/* jquery 필요 (use fade animation) */
/* 모달 공용 함수 (쓰는곳에서 인스턴스 생성해야됩니다.)
 [마크업]
 * <div id="modal-name" class="ormn-modal center"> //center 클래스넣어서 적어두시면 가운데팝업, dev클래스 붙이시면 마크업때 보이게 됩니다.
	<div class="modal-inner">		
		<div class="modal-wrapper">
			<div class="modal-header">
				<a href="#" class="modal-close-btn"><span class="a11y">닫기</span></a>
			</div>
			<div class="modal-body">
				모달내용
			</div>
			<div class="modal-footer">
				<div class="btn-wrapper">
					//버튼은 갯수 상관없이 가로 배열, 모바일에서는 세로배열
					<button type="button" class="modal-btn primary">확인</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal-dim"></div>
</div>
*/
var CommonModal = /*#__PURE__*/function () {
  function CommonModal(element) {
    _classCallCheck(this, CommonModal);
    this.popup = $(element);
    this.popupContent = this.popup.find(".modal-wrapper");
    this.closeBtn = this.popup.find(".modal-close-btn");
    this.dim = this.popup.find(".modal-dim");
  }
  _createClass(CommonModal, [{
    key: "init",
    value: function init() {
      var _this3 = this;
      this.closeBtn.on("click", function (e) {
        e.preventDefault();
        _this3.close();
      });
    }
  }, {
    key: "open",
    value: function open() {
      var _this4 = this;
      this.popup.show(0, function () {
        console.log("ee");
        _this4.dim.fadeIn(200, function () {
          _this4.popupContent.fadeIn(200, function () {
            if (_this4.popup.hasClass("center")) {
              //컨텐츠 높이가 뷰포트보다 길면 class추가
              var extraHeight = 300;
              var modalHeight = _this4.popupContent.height();
              var windowHeight = $(window).height();
              modalHeight + extraHeight > windowHeight ? _this4.popup.addClass("block") : _this4.popup.addClass("flex");
            }
          });
        });
      });
    }
  }, {
    key: "close",
    value: function close() {
      var _this5 = this;
      this.popup.fadeOut(200, function () {
        _this5.popupContent.hide();
        _this5.dim.hide();
      });
    }
  }]);
  return CommonModal;
}();
var hScrollDrag = /*#__PURE__*/function () {
  function hScrollDrag(target, options) {
    var _this6 = this;
    _classCallCheck(this, hScrollDrag);
    this.isDown = false;
    this.startX;
    this.cal_scroll;
    this.isDragged = false;
    this.acc = options && options.acc || 1;
    this.scrollbar = options && options.scrollBar;
    this.slider = target[0];
    this.item = this.slider.querySelector('.h-scroll-container');

    /* initializing h-scroll zone & set style  */
    this.createDragZone();
    this.setStyle();
    this.setScrollbarStyle();

    /* add event handler */
    this.slider.addEventListener('mousedown', function (e) {
      return _this6.mousedownHandler(e);
    });
    this.slider.addEventListener('mouseleave', function (e) {
      return _this6.mouseleaveHandler(e);
    });
    this.slider.addEventListener('mouseup', function (e) {
      return _this6.mouseupHandler(e);
    });
    this.slider.addEventListener('mousemove', function (e) {
      return _this6.mousemoveHandler(e);
    });
  }
  _createClass(hScrollDrag, [{
    key: "setStyle",
    value: function setStyle() {
      this.slider.classList.add('h-scroll-init');
    }
  }, {
    key: "setScrollbarStyle",
    value: function setScrollbarStyle() {
      if (this.scrollbar == 'undefined' || this.scrollbar == false) {
        this.slider.classList.add('no-scroll-bar');
      }
    }
  }, {
    key: "createDragZone",
    value: function createDragZone() {
      this.dragZone = document.createElement('div');
      this.dragZone.classList.add('drag-zone');
      this.dragZone.appendChild(this.item);
      this.slider.appendChild(this.dragZone);
    }
  }, {
    key: "preventClick",
    value: function preventClick(e) {
      e.preventDefault();
      e.stopImmediatePropagation();
    }
  }, {
    key: "mousedownHandler",
    value: function mousedownHandler(e) {
      this.isDown = true;
      this.slider.classList.add('is-dragging');
      this.startX = e.pageX - this.slider.offsetLeft;
      this.cal_scroll = this.slider.scrollLeft;
    }
  }, {
    key: "mouseleaveHandler",
    value: function mouseleaveHandler() {
      this.isDown = false;
      this.slider.classList.remove('is-dragging');
    }
  }, {
    key: "mouseupHandler",
    value: function mouseupHandler(e) {
      this.isDown = false;
      if (this.isDragged) {
        this.item.addEventListener('click', this.preventClick);
      } else {
        this.item.removeEventListener('click', this.preventClick);
      }
      this.slider.classList.remove('is-dragging');
      this.isDragged = false;
    }
  }, {
    key: "mousemoveHandler",
    value: function mousemoveHandler(e) {
      if (!this.isDown) return;
      this.isDragged = true;
      e.preventDefault();
      var x = e.pageX - this.slider.offsetLeft;
      var walk = (x - this.startX) * this.acc;
      this.slider.scrollLeft = this.cal_scroll - walk;
    }
  }, {
    key: "moveTo",
    value: function moveTo(x) {
      this.slider.scrollLeft = x;
    }
  }]);
  return hScrollDrag;
}();